# Component Test
esphome:
  name: test-tc-bus
  friendly_name: TC BUS Component Test

esp8266:
  board: esp01_1m

wifi:
  ssid: "My Network"
  password: "My Password"

api:

external_components:
  - source:
      type: local
      path: "../components"

remote_receiver:
  pin:
    number: GPIO12
    mode: INPUT
  filter: 1500us
  idle: 7000us

remote_transmitter:
  pin:
    number: GPIO13
    mode: OUTPUT
  carrier_duty_percent: 100%

tc_bus:
  id: my_tc_bus
  event: "doorman"
  on_telegram:
    - logger.log: "Bus Telegram received"

tc_bus_device:
  - id: my_indoor_station
    type: indoor_station

    on_read_memory_complete:
      - lambda: |-
          std::string hexString = str_upper_case(format_hex(x));
          ESP_LOGI("tcs_bus", "Memory reading completed. Data: %s", hexString.c_str());
    
    on_read_memory_timeout:
      - logger.log:
          format: "Memory reading timed out! No memory block received in time."
          level: ERROR
    
    on_identify_complete:
      - logger.log:
          format: "Identified Hardware: %s (v%i) | Firmware: %i.%i.%i"
          args: [ 'model_to_string(x.model)', 'x.hardware_version', 'x.firmware_major', 'x.firmware_minor', 'x.firmware_patch' ]
          level: INFO
    
    on_identify_unknown:
      - logger.log: "Setup: Unable to identify the Indoor Station, unknown model."
    
    on_identify_timeout:
      - logger.log:
          format: "Failed to identify the Indoor Station. Please select it manually."
          level: ERROR



text_sensor:
  - platform: tc_bus
    tc_bus: my_tc_bus
    hardware_version:
      name: "Hardware"
    bus_telegram:
      name: "Last Bus Telegram"

number:
  - platform: tc_bus_device
    device_id: my_indoor_station
    serial_number:
      name: "Serial Number"
    volume_ringtone:
      name: "Volume: Ringtone"
    volume_handset_door_call:
      name: "Volume: Handset Door Call"
    volume_handset_internal_call:
      name: "Volume: Handset Internal Call"

select:
  - platform: tc_bus_device
    device_id: my_indoor_station
    model:
      name: "Indoor Station Model"
    ringtone_entrance_door_call:
      name: "Ringtone: Entrance Door Call"
    ringtone_second_entrance_door_call:
      name: "Ringtone: Second Entrance Door Call"
    ringtone_floor_call:
      name: "Ringtone: Floor Call"
    ringtone_internal_call:
      name: "Ringtone: Internal Call"

switch:
  - platform: tc_bus_device
    device_id: my_indoor_station
    force_long_door_opener:
      name: "Enforce long Door Opener Telegram"

button:
  - platform: template
    id: open_entrance_door
    name: "Open Entrance Door"
    icon: mdi:door
    on_press:
      - tc_bus_device.send:
          id: my_indoor_station
          type: open_door
          address: 0

binary_sensor:
  - platform: tc_bus_device
    device_id: my_indoor_station
    id: entrance_doorbell
    name: "Entrance Doorbell"
    type: door_call
    auto_off: 0.2s

  - platform: template
    name: "Read Memory"
    on_press:
      - tc_bus_device.read_memory:
          id: my_indoor_station

  - platform: template
    name: "Identify Indoor Station"
    on_press:
      - tc_bus_device.identify:
          id: my_indoor_station